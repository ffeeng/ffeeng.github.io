import{_ as s,c as a,b as n,o as p}from"./chunks/framework.CUf7xJpa.js";const l=JSON.parse('{"title":"ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶ Playwright ä½¿ç”¨å…¥é—¨","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. playwright ä»‹ç»","slug":"_1-playwright-ä»‹ç»","link":"#_1-playwright-ä»‹ç»","children":[]},{"level":2,"title":"2. Playwright Test for VSCode","slug":"_2-playwright-test-for-vscode","link":"#_2-playwright-test-for-vscode","children":[]},{"level":2,"title":"3. åˆå§‹åŒ–é¡¹ç›®","slug":"_3-åˆå§‹åŒ–é¡¹ç›®","link":"#_3-åˆå§‹åŒ–é¡¹ç›®","children":[]},{"level":2,"title":"4. è¿è¡Œæµ‹è¯•","slug":"_4-è¿è¡Œæµ‹è¯•","link":"#_4-è¿è¡Œæµ‹è¯•","children":[]},{"level":2,"title":"5. æ·»åŠ  cookie","slug":"_5-æ·»åŠ -cookie","link":"#_5-æ·»åŠ -cookie","children":[]},{"level":2,"title":"6. å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹","slug":"_6-å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹","link":"#_6-å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹","children":[]},{"level":2,"title":"7. æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€","slug":"_7-æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€","link":"#_7-æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€","children":[]},{"level":2,"title":"8. å°ç»“","slug":"_8-å°ç»“","link":"#_8-å°ç»“","children":[]}],"relativePath":"business/playwright.md","filePath":"business/playwright.md"}');const o=s({name:"business/playwright.md"},[["render",function(s,l,o,t,e,c){return p(),a("div",null,l[0]||(l[0]=[n('<h1 id="ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶-playwright-ä½¿ç”¨å…¥é—¨" tabindex="-1">ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶ Playwright ä½¿ç”¨å…¥é—¨ <a class="header-anchor" href="#ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶-playwright-ä½¿ç”¨å…¥é—¨" aria-label="Permalink to &quot;ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶ Playwright ä½¿ç”¨å…¥é—¨&quot;">â€‹</a></h1><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.cn/post/7289740992508215296" target="_blank" rel="noreferrer">https://juejin.cn/post/7289740992508215296</a></p><blockquote><p>ğŸ“Œæ¨èè¯­ï¼š 2020å¹´ï¼Œå¾®è½¯ï¼ˆMicrosoftï¼‰å¼€æºäº†ä¸€ä¸ªåä¸ºPlaywrightçš„å·¥å…·ï¼Œä¸Seleniumä¸€æ ·å…¥é—¨ç®€å•ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼ˆPythonã€Javaã€Node.jsã€.NETï¼‰ï¼Œæ”¯æŒå¤šæµè§ˆå™¨ï¼ˆChromiumã€Firefoxã€Webkitï¼‰,å¯è·¨å¹³å°ï¼ˆWindowsã€Linuxã€Mac OSï¼‰ã€‚PlaywrightåŒæ—¶æ”¯æŒæ¥å£è‡ªåŠ¨åŒ–å’ŒUIè‡ªåŠ¨åŒ–ï¼Œä¸ºç°ä»£webåº”ç”¨æä¾›äº†å¯é çš„ç«¯åˆ°ç«¯çš„æµ‹è¯•èƒ½åŠ›ã€‚ â€¢ Playwrightä¼˜åŠ¿ï¼š 1ï¼‰è‡ªåŠ¨ç­‰å¾…åŠŸèƒ½è®©è‡ªåŠ¨åŒ–æ›´å¯é ï¼› 2ï¼‰è‡ªåŠ¨è¿½è¸ªï¼šå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é…ç½®é‡è¯•ç­–ç•¥ï¼Œè‡ªåŠ¨çš„è¿½è¸ªç»“æœï¼Œä»¥æˆªå›¾å’Œå½•å±çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼› 3ï¼‰æ–­è¨€æœºåˆ¶ï¼šä¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè¿›è¡Œè‡ªåŠ¨æ–­è¨€ï¼Œç›´åˆ°æ»¡è¶³æŸç§æ¡ä»¶ä¸ºæ­¢ï¼› 4ï¼‰å¼‚æ­¥æ‰§è¡Œï¼šPlaywrightåŸºäºsocketè¿›è¡ŒåŒå‘é€šè®¯ï¼Œæ”¯æŒåŒæ­¥ä¸å¼‚æ­¥æ‰§è¡Œä¸¤ç§æ–¹å¼ï¼› 5ï¼‰å¯è¿è¡Œå¤šé¡µä»¿çœŸåœºæ™¯ï¼šPlaywrightæ˜¯é€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†æµè§ˆå™¨ï¼Œç›¸å½“äºæ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ï¼Œæµè§ˆå™¨çš„ä¸Šä¸‹æ–‡å…¶å®å°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„æµè§ˆå™¨ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯åœ¨æé€Ÿçš„åŒæ—¶åˆå®ç°æµ‹è¯•ä¸æµ‹è¯•ä¹‹é—´çš„éš”ç¦»ï¼Œä½¿å¾—æµ‹è¯•ç»“æœæ›´åŠ å‡†ç¡®ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¹¶è¡Œæ‰§è¡Œï¼› 6ï¼‰å¼ºå¤§çš„å·¥å…·é›†ï¼šè¿˜æä¾›äº†å¼ºå¤§çš„å·¥å…·é›†ï¼Œä¾‹å¦‚ï¼šè„šæœ¬å½•åˆ¶å·¥å…·codegenã€è„šæœ¬ç¼–å†™ä»¥åŠè°ƒè¯•å·¥å…·playwrightç­‰ã€‚ å®˜ç½‘é“¾æ¥ï¼š<a href="https://playwright.dev/" target="_blank" rel="noreferrer">https://playwright.dev/</a></p></blockquote><p><img src="/assets/img.Cm67-o-r.png" alt="img.png"></p><h2 id="_1-playwright-ä»‹ç»" tabindex="-1">1. playwright ä»‹ç» <a class="header-anchor" href="#_1-playwright-ä»‹ç»" aria-label="Permalink to &quot;1. playwright ä»‹ç»&quot;">â€‹</a></h2><p>Playwright æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æµ‹è¯•æ¡†æ¶ï¼Œ å®ƒå¯åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­è¿è¡ŒåŠŸèƒ½å¼ºå¤§çš„æµ‹è¯•å’Œè‡ªåŠ¨åŒ–ã€‚æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ APIï¼Œ åŒ…æ‹¬ JavaScript ã€TypeScriptã€Python, .NETå’ŒJavaã€‚æ­£å› ä¸ºå®ƒåŸºäºæµè§ˆå™¨ï¼Œç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·çœŸå®æ“ä½œï¼Œå› æ­¤ä¸å…‰èƒ½å¤Ÿç”¨æ¥è·‘æµ‹è¯•ç”¨ä¾‹ï¼Œè¿˜å¯ä»¥ç”¨æ¥å†™çˆ¬è™«ã€‚</p><h2 id="_2-playwright-test-for-vscode" tabindex="-1">2. Playwright Test for VSCode <a class="header-anchor" href="#_2-playwright-test-for-vscode" aria-label="Permalink to &quot;2. Playwright Test for VSCode&quot;">â€‹</a></h2><p>æˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸ª vscode æ’ä»¶Playwright Test for VSCodeï¼Œæ¥å¸®åŠ©æˆ‘ä»¬è¿è¡Œã€å½•åˆ¶ã€è°ƒè¯•æµ‹è¯•ç”¨ä¾‹ã€‚ <img src="/assets/img_1.y7w4alpH.png" alt="img_1.png"></p><h2 id="_3-åˆå§‹åŒ–é¡¹ç›®" tabindex="-1">3. åˆå§‹åŒ–é¡¹ç›® <a class="header-anchor" href="#_3-åˆå§‹åŒ–é¡¹ç›®" aria-label="Permalink to &quot;3. åˆå§‹åŒ–é¡¹ç›®&quot;">â€‹</a></h2><p>å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰å®‰è£…PlaywrightNPM åŒ…ï¼Œæˆ–è€…é‡æ–°å¼€å§‹ä¸€ä¸ªæ–°çš„æµ‹è¯•é¡¹ç›®ï¼Œéœ€è¦å¯ä»¥åœ¨ vscode å‘½ä»¤é¢æ¿ä¸­è¾“å…¥intsll Playwrightã€‚ <img src="/assets/img_2.QHv3uu_4.png" alt="img_2.png"> é€‰æ‹©æˆ‘ä»¬å¸¸ç”¨çš„æµè§ˆå™¨ï¼Œä¸å¿…æ‹…å¿ƒé€‰é”™ï¼Œåé¢å¯ä»¥åœ¨é¡¹ç›®ä¸­æ›´æ”¹ã€‚è¿˜å¯ä»¥é€‰æ‹© GitHub Action ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾åœ¨ Github ä¸­æŒç»­é›†æˆã€‚</p><p>è¿™é‡Œæˆ‘é€‰æ‹© chromiumï¼Œè¿™æ ·å¯ä»¥åªä¸‹è½½ä¸€ä¸ªæµè§ˆå™¨å†…æ ¸ã€‚ <img src="/assets/img_3.BOLpFzdL.png" alt="img_3.png"></p><p>ç‚¹å‡»OKåï¼Œæ’ä»¶ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆå§‹åŒ–ç¨‹åºï¼Œ ä¸‹å›¾æ˜¯åˆå§‹åŒ–çš„ç›®å½•ç»“æ„ <img src="/assets/img_4.CwtvPRx7.png" alt="img_4.png"></p><p>é…ç½®æ–‡ä»¶éƒ½åœ¨playwright.config.tsä¸­ã€‚</p><p>çœ‹ä¸‹package.jsonï¼ŒåªåŒ…å«äº†ä¸€ä¸ªåŒ…@playwright/test <img src="/assets/img_5.DI2Qevvw.png" alt="img_5.png"></p><h2 id="_4-è¿è¡Œæµ‹è¯•" tabindex="-1">4. è¿è¡Œæµ‹è¯• <a class="header-anchor" href="#_4-è¿è¡Œæµ‹è¯•" aria-label="Permalink to &quot;4. è¿è¡Œæµ‹è¯•&quot;">â€‹</a></h2><p>æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹éƒ½è¦å†™åœ¨testsæ–‡ä»¶å¤¹ä¸­ï¼Œé»˜è®¤æœ‰ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ŒåŒ…å«æœ‰ 2 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä»£ç åœ¨example.spec.tsä¸­ã€‚ <img src="/assets/img_6.CvINpxLj.png" alt="img_6.png"></p><p>ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼šç¡®ä¿æ ‡é¢˜åŒ…å« Playwrightï¼›</p><p>ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹ï¼šç¡®ä¿ç‚¹å‡» â€œGet Startedâ€åï¼Œè·³è½¬åˆ° intro çš„é“¾æ¥ã€‚</p><p>é€‰æ‹©å·¦ä¾§çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä¸”å‹¾é€‰Show browserï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç›´è§‚çš„çœ‹åˆ° Playwright è¿è¡Œæµ‹è¯•çš„è¿‡ç¨‹ã€‚ <img src="/assets/img_7.CcKXHIpA.png" alt="img_7.png"></p><p>ä»¥ä¸Šä¾‹å­é»˜è®¤æ˜¯ä½¿ç”¨ chromium æ¥è¿è¡Œçš„ï¼Œå¹¶ä¸” chromium ä¸åŒ…å«ä»»ä½• cookie å’Œç¼“å­˜ä¿¡æ¯ã€‚</p><p>åœ¨playwright.config.tsé…ç½®æ–‡ä»¶ä¸­ï¼Œ å¯ä»¥é…ç½®å¯ç”¨çš„æµè§ˆå™¨ä¸º chromeï¼Œæˆ‘ä»¬åªéœ€è¦å¢åŠ ä¸€ä¸ªå‚æ•°channelï¼Œè®© Playwright ä½¿ç”¨æµè§ˆå™¨æ¥è¿è¡Œã€‚ ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æµè§ˆå™¨ï¼Œå‚æ•°å¯ä»¥ä¸ºï¼š &quot;chrome&quot;, &quot;chrome-beta&quot;, &quot;chrome-dev&quot;, &quot;chrome-canary&quot;, &quot;msedge&quot;, &quot;msedge-beta&quot;, &quot;msedge-dev&quot;ï¼Œ&quot;msedge-canary&quot;.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>use: {</span></span>\n<span class="line"><span>    channel:&#39;chrome&#39;,</span></span>\n<span class="line"><span>     /* Base URL to use in actions like `await page.goto(&#39;/&#39;)`. */</span></span>\n<span class="line"><span>     // baseURL: &#39;http://127.0.0.1:3000&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>    /* Collect trace when retrying the failed test. See https://playwright.dev/docs/trace-viewer */</span></span>\n<span class="line"><span>    trace: &#39;on-first-retry&#39;,</span></span>\n<span class="line"><span>},</span></span></code></pre></div><p>æˆ‘ä»¬è™½ç„¶æ”¹æˆäº†ä½¿ç”¨æµè§ˆå™¨æ¥è¿è¡Œï¼Œä½†æ˜¯å¯åŠ¨çš„æµè§ˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªæ— ç—•æ¨¡å¼ï¼Œä¸åŒ…å«ä»»ä½•ç¼“å­˜ä¿¡æ¯ã€‚</p><h2 id="_5-æ·»åŠ -cookie" tabindex="-1">5. æ·»åŠ  cookie <a class="header-anchor" href="#_5-æ·»åŠ -cookie" aria-label="Permalink to &quot;5. æ·»åŠ  cookie&quot;">â€‹</a></h2><p>æµ‹è¯•çš„ç³»ç»Ÿå¾€å¾€éœ€è¦ç™»å½•ï¼Œè€Œåœ¨è¿è¡Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¹‹å‰è¿è¡Œï¼Œéƒ½éœ€è¦ç™»å½•ï¼Œè¿™è‚¯å®šæ˜¯ç¹ççš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæµ‹è¯•ç”¨ä¾‹ä¹‹å‰ï¼Œæ‰‹åŠ¨æ‹·è´ cookiesï¼Œæ³¨å…¥åˆ°æµè§ˆå™¨ä¸­ã€‚</p><p>æ¯”å¦‚æ˜é‡‘çš„æ¯æ—¥ç­¾åˆ°å’ŒæŠ½å¥–ï¼Œæˆ‘å°±å¯ä»¥ä½¿ç”¨ Playwright æ¥å®ç°è‡ªåŠ¨åŒ–</p><p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { test, expect, </span><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> Page } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &quot;@playwright/test&quot;</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ç™»å½•&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({</span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">}) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">addCookies</span><span style="color:#E1E4E8;">([</span></span>\n<span class="line"><span style="color:#E1E4E8;">{</span></span>\n<span class="line"><span style="color:#E1E4E8;">name: </span><span style="color:#9ECBFF;">&quot;sessionid&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">value: </span><span style="color:#9ECBFF;">&quot;xxx&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">path: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">domain: </span><span style="color:#9ECBFF;">&quot;.juejin.cn&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">},</span></span>\n<span class="line"><span style="color:#E1E4E8;">{</span></span>\n<span class="line"><span style="color:#E1E4E8;">name: </span><span style="color:#9ECBFF;">&quot;sessionid_ss&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">value: </span><span style="color:#9ECBFF;">&quot;xxx&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">path: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">domain: </span><span style="color:#9ECBFF;">&quot;.juejin.cn&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">},</span></span>\n<span class="line"><span style="color:#E1E4E8;">]);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><p>æ‰“å¼€ chrome æ§åˆ¶å°ï¼Œå¤åˆ¶ cookiesï¼Œ æ·»åŠ åˆ°ä»£ç ä¸­ <img src="/assets/img_8.d1CxTywd.png" alt="img_8.png"> æ­¤æ—¶ç‚¹å‡»å·¦ä¾§è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå‘ç°å·²ç»æ˜¯ç™»å½•çŠ¶æ€ã€‚</p><h2 id="_6-å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹" tabindex="-1">6. å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ <a class="header-anchor" href="#_6-å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹" aria-label="Permalink to &quot;6. å½•åˆ¶ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹&quot;">â€‹</a></h2><p>å¦‚æœè¦æ‰‹åŠ¨å»æŸ¥æ‰¾ dom ï¼Œä»é›¶å¼€å§‹å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è‚¯å®šæ˜¯ç¹ççš„ï¼Œå› æ­¤ Playwright VSCode æ’ä»¶æä¾›äº†å½•åˆ¶åŠŸèƒ½ã€‚</p><p>è¿è¡Œä¸Šä¸€æ¬¡æµ‹è¯•ç”¨ä¾‹åï¼Œæµè§ˆå™¨æ˜¯æœªå…³é—­çš„ã€‚æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡» vscode å·¦ä¾§çš„Record newæŒ‰é’®ï¼Œvscode ä¾¿ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œå¹¶ä¸”è®°å½•æ“ä½œæ­¥éª¤ã€‚</p><p>å½•åˆ¶æ—¶ï¼Œæµè§ˆå™¨åˆæ˜¯ä¸€ä¸ªå…¨æ–°çš„ï¼Œä¸ä¿ç•™ä»»ä½•çŠ¶æ€ï¼Œé‚£å¦‚æœæˆ‘ä»¬è¦æµ‹è¯•çš„æ˜¯ç™»å½•åçš„åŠŸèƒ½ï¼Œå²‚ä¸æ˜¯åˆè¦ç™»å½•ï¼Ÿ å…¶å® playwright å¯ä»¥ä¿å­˜ç™»å½•çŠ¶æ€ã€‚</p><p>åœ¨ä¸Šé¢æµ‹è¯•ç”¨ä¾‹ååŠ ä¸€å¥ storageStateã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { test, expect, </span><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> Page } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &quot;@playwright/test&quot;</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ç™»å½•&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({</span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">}) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">addCookies</span><span style="color:#E1E4E8;">([</span></span>\n<span class="line"><span style="color:#E1E4E8;">{</span></span>\n<span class="line"><span style="color:#E1E4E8;">name: </span><span style="color:#9ECBFF;">&quot;sessionid&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">value: </span><span style="color:#9ECBFF;">&quot;xxx&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">path: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">domain: </span><span style="color:#9ECBFF;">&quot;.juejin.cn&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">},</span></span>\n<span class="line"><span style="color:#E1E4E8;">{</span></span>\n<span class="line"><span style="color:#E1E4E8;">name: </span><span style="color:#9ECBFF;">&quot;sessionid_ss&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">value: </span><span style="color:#9ECBFF;">&quot;xxx&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">path: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">domain: </span><span style="color:#9ECBFF;">&quot;.juejin.cn&quot;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">},</span></span>\n<span class="line"><span style="color:#E1E4E8;">]);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">+</span><span style="color:#F97583;">   await</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">storageState</span><span style="color:#E1E4E8;">({ path: </span><span style="color:#9ECBFF;">&#39;state.json&#39;</span><span style="color:#E1E4E8;"> });</span></span>\n<span class="line"><span style="color:#E1E4E8;">    });</span></span></code></pre></div><pre><code>å¹¶ä¸”åœ¨playwright.config.tsä¸­ï¼Œé…ç½®å­˜å‚¨ä½ç½®ã€‚\n</code></pre><p><img src="/assets/img_9.CD1hr26L.png" alt="img_9.png"> æ­¤æ—¶æˆ‘ä»¬å½•åˆ¶æ“ä½œï¼Œå°±å·²ç»æ˜¯ç™»å½•çŠ¶æ€äº†ã€‚ <img src="/assets/img_10.cSh0Oq19.png" alt="img_10.png"> ä»¥ä¸‹ä¾¿æ˜¯å½•åˆ¶åçš„ä»£ç ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { test, expect } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@playwright/test&#39;</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;test&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;https://juejin.cn/&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;button&#39;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&#39;å»ç­¾åˆ°&#39;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;button&#39;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&#39;ç«‹å³ç­¾åˆ°&#39;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;button&#39;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&#39;å»æŠ½å¥–&#39;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;å…è´¹æŠ½å¥–æ¬¡æ•°ï¼š1æ¬¡&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;button&#39;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&#39;æ”¶ä¸‹å¥–åŠ±&#39;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><p>å½•åˆ¶å®Œæˆåï¼Œç›´æ¥è¿è¡Œä»£ç å¯èƒ½ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰äº›æ–‡æœ¬æ˜¯å¼‚æ­¥è¯·æ±‚å®ç°çš„ï¼Œæœ‰äº›äº‹ä»¶æ˜¯è¯·æ±‚æˆåŠŸåç»‘å®šçš„ï¼Œåœ¨æ‰‹åŠ¨å½•åˆ¶æ—¶ï¼Œå› ä¸ºå·²ç»å“åº”å®Œæˆï¼Œå› æ­¤æ²¡é—®é¢˜ï¼Œæˆ‘ä»¬åŠ ä¸Š 2 å¥å»¶è¿Ÿã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;test&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">+</span><span style="color:#F97583;">  await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">   await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">å»ç­¾åˆ°</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">å·²ç­¾åˆ°</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">+</span><span style="color:#F97583;">  await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">   await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">ä»Šæ—¥å·²ç­¾åˆ°</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">ç«‹å³ç­¾åˆ°</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">   await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&quot;å»æŠ½å¥–&quot;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> lotteryElement</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#turntable-item-0&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> buttonText</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> lotteryElement?.</span><span style="color:#B392F0;">textContent</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (buttonText </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &quot;å…è´¹æŠ½å¥–æ¬¡æ•°ï¼š1æ¬¡&quot;</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> lotteryElement?.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&quot;æ”¶ä¸‹å¥–åŠ±&quot;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#B392F0;">expect</span><span style="color:#E1E4E8;">(</span></span>\n<span class="line"><span style="color:#E1E4E8;">page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#turntable-item-0&quot;</span><span style="color:#E1E4E8;">, { hasText:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">å•æŠ½</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> })</span></span>\n<span class="line"><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">toBeDefined</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><p>ä¾¿å¯ä»¥è¿è¡ŒæˆåŠŸï¼Œæ³¨æ„è¿™é‡Œæˆ‘ä½¿ç”¨äº†waitForTimeoutè¿™ä¸ª api åœ¨å®˜ç½‘ä¸­å·²ç»è¢«æ ‡è®°äº†åºŸå¼ƒ(deprecate)</p><p>å®é™…æµ‹è¯•åœºæ™¯ä¸­è¯·ä½¿ç”¨æ”¹ç”¨ç½‘ç»œäº‹ä»¶ã€é€‰æ‹©å™¨å˜å¾—å¯è§ç­‰ä¿¡å·ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForResponse</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>\n<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/user_api/v1/incentive_activity/award_after_login&quot;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">å»ç­¾åˆ°</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">å·²ç­¾åˆ°</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForResponse</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>\n<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/growth_api/v2/get_today_status&quot;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">ä»Šæ—¥å·²ç­¾åˆ°</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">ç«‹å³ç­¾åˆ°</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><p>ç­‰å¾…æ¥å£å“åº”æˆåŠŸåå†å‡ºå‘ç‚¹å‡»äº‹ä»¶ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œè‡ªåŠ¨å½•åˆ¶çš„ä»£ç ï¼Œä¸€èˆ¬ä½¿ç”¨äº†è¯­ä¹‰åŒ–å®šä½æ–¹æ³•ï¼Œæ¯”å¦‚getByRoleã€getByTextï¼Œè¿™äº›å®šä½å™¨å¾€å¾€ä¸å¤Ÿå‡†ç¡®ï¼Œæ”¹åŠ¨ä»£ç ä¼šå¯¼è‡´æµ‹è¯•ç”¨ä¾‹å¤±æ•ˆã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨locatorå®šä½å™¨æ¥æ›¿æ¢ã€‚</p><p>åœ¨ Playwright ä¸­ï¼ŒLocator è¡¨ç¤ºä¸€ç§å…ƒç´ æŸ¥æ‰¾æ–¹å¼ï¼Œæ˜¯ Playwright æä¾›çš„ä¸€ç»„æ–¹æ³•ï¼Œç”¨äºå®šä½é¡µé¢ä¸Šçš„å…ƒç´ ã€‚ Locator æ”¯æŒ XPath å’Œ CSS é€‰æ‹©å™¨</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span></span>\n<span class="line"><span style="color:#9ECBFF;">&#39;#tsf &gt; div:nth-child(2) &gt; div.A8SBwf &gt; div.RNNXgb &gt; div &gt; div.a4bIc &gt; input&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page</span></span>\n<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;//*[@id=&quot;tsf&quot;]/div[2]/div[1]/div[1]/div/div[2]/input&#39;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><p>åœ¨ vscode ä¸­å¯ä»¥ä½¿ç”¨ Pick locator å¿«é€Ÿæ´»åŠ¨å½“å‰çš„ dom å®šä½ã€‚ <img src="/assets/img_11.DLeWYXEw.png" alt="img_11.png"><img src="/assets/img_12.DN2Lj9Lb.png" alt="img_12.png"></p><h2 id="_7-æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€" tabindex="-1">7. æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€ <a class="header-anchor" href="#_7-æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€" aria-label="Permalink to &quot;7. æµ‹è¯•ç”¨ä¾‹åŠæ–­è¨€&quot;">â€‹</a></h2><p>å½•åˆ¶çš„æµ‹è¯•ä»£ç åªèƒ½ç¡®ä¿ä¸šåŠ¡èƒ½å¤Ÿè·‘é€šï¼Œä½†ä¸èƒ½è¯æ˜ç¨‹åºçš„å¯é ä¸å¥å£®ã€‚ä¸€æ—¦æµ‹è¯•ç”¨ä¾‹å‡ºé”™ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ç¨‹åºé”™è¯¯è¿˜æ˜¯æµ‹è¯•ç”¨ä¾‹é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ ¹æ®æµ‹è¯•ç”¨ä¾‹æ¥å†™å¯é çš„æµ‹è¯•ä»£ç ã€‚</p><p>æ¯”å¦‚ä¸Šè¿°æ˜é‡‘æŠ½å¥–ç¨‹åºå¯ä»¥åŒ…å«ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ â€¢ ç­¾åˆ°çš„çŠ¶æ€éœ€è¦æ ¹æ®æ¥å£è¿”å›æ˜¾ç¤º é€šè¿‡ network æŸ¥çœ‹ç­¾åˆ°è¿”å›å¦‚ä¸‹ï¼š <img src="/assets/img_13.SsfZ5tx5.png" alt="img_13.png"> å› æ­¤æˆ‘çš„ç­¾åˆ°æµ‹è¯•ç”¨ä¾‹ä»£ç å¦‚ä¸‹</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ç­¾åˆ°çš„çŠ¶æ€æ ¹æ®æ¥å£è¿”å›æ˜¾ç¤º&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/user/center/signin&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> promise</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForResponse</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>\n<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/growth_api/v2/get_today_status&quot;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> res</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> promise.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (res.data.check_in_done) {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.signedin&quot;</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toHaveText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ä»Šæ—¥å·²ç­¾åˆ°&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.signedin&quot;</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toHaveText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ç«‹å³ç­¾åˆ°&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name:</span><span style="color:#9ECBFF;"> /</span><span style="color:#DBEDFF;">ç«‹å³ç­¾åˆ°</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getByRole</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">, { name: </span><span style="color:#9ECBFF;">&quot;å»æŠ½å¥–&quot;</span><span style="color:#E1E4E8;"> }).</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#6A737D;">//è°ƒæ•´åˆ°æŠ½å¥–é¡µé¢</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page).</span><span style="color:#B392F0;">toHaveURL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">user</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">center</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">lottery</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><ul><li>æŠ½å¥–é¡µé¢ï¼Œæ ¹æ®æ¥å£è¿”å›æ˜¾ç¤ºæŠ½å¥–æ¬¡æ•°å’Œå¥–å“ é€šè¿‡ networkï¼Œçœ‹åˆ°æŠ½å¥–é…ç½®æ¥å£è¿”å›å¦‚ä¸‹ï¼š <img src="/assets/img_14.8NWF7zAK.png" alt="img_14.png"> å› æ­¤æˆ‘çš„æµ‹è¯•ç”¨ä¾‹ä»£ç å¦‚ä¸‹</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;æ ¹æ®æ¥å£è¿”å›æ˜¾ç¤ºæŠ½å¥–æ¬¡æ•°&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://juejin.cn/user/center/lottery&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> promise</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForResponse</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>\n<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/growth_api/v1/lottery_config/get&quot;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> res</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> promise.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> lotteryNames</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> res.data.lottery.</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (item.unlock_count </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#F97583;">return</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> RegExp</span><span style="color:#E1E4E8;">(item.lottery_name);</span></span>\n<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">return</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> RegExp</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`å†æŠ½${</span><span style="color:#E1E4E8;">item</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">unlock_count</span><span style="color:#9ECBFF;">}æ¬¡è§£é”`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.item-container .turntable-item&quot;</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toHaveText</span><span style="color:#E1E4E8;">(</span></span>\n<span class="line"><span style="color:#E1E4E8;">lotteryNames</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (res.data.free_count) {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#turntable-item-0&quot;</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toHaveText</span><span style="color:#E1E4E8;">(</span></span>\n<span class="line"><span style="color:#9ECBFF;">`å…è´¹æŠ½å¥–æ¬¡æ•°ï¼š${</span><span style="color:#E1E4E8;">res</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">data</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">free_count</span><span style="color:#9ECBFF;">}æ¬¡`</span></span>\n<span class="line"><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#F97583;">await</span><span style="color:#B392F0;"> expect</span><span style="color:#E1E4E8;">(page.</span><span style="color:#B392F0;">locator</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#turntable-item-0&quot;</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toHaveText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;å•æŠ½ 200&quot;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><p>æœ‰äº†ä»¥ä¸Šæ–­è¨€ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç¡®ä¿å‰ç«¯é¡µé¢æ˜¾ç¤ºä¸æ¥å£è¿”å›æ˜¾ç¤ºä¸€è‡´ã€‚ è¿è¡Œå®Œæˆåï¼Œå¯ä»¥åœ¨ playwright-report æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šã€‚ <img src="/assets/img_15.CbxyFyG1.png" alt="img_15.png"></p><h2 id="_8-å°ç»“" tabindex="-1">8. å°ç»“ <a class="header-anchor" href="#_8-å°ç»“" aria-label="Permalink to &quot;8. å°ç»“&quot;">â€‹</a></h2><p>æœ¬æ–‡ä»‹ç»äº† Playwright æµ‹è¯•æ¡†æ¶çš„å…¥é—¨ä½¿ç”¨ï¼ŒPlaywright æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ APIï¼Œé€‚ç”¨äºç°ä»£æµè§ˆå™¨ï¼Œè¿˜å¯ç”¨äºç¼–å†™ç½‘ç»œçˆ¬è™«ã€‚</p><p>é¦–å…ˆä»‹ç»äº† Playwright Test for VSCode æ’ä»¶ï¼Œä»¥åŠå¦‚ä½•åˆå§‹åŒ–æµ‹è¯•é¡¹ç›®ï¼Œå¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æŒ‡å‡ºå¯ä»¥é€‰æ‹©ä¸åŒçš„æµè§ˆå™¨ä½œä¸ºæµ‹è¯•ç¯å¢ƒï¼Œ å¦‚ä½•æ·»åŠ  Cookie æ¥æ¨¡æ‹Ÿç™»å½•çŠ¶æ€ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å½•åˆ¶åŠŸèƒ½æ¥è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ä»£ç ã€‚</p><p>å¦å¤–ï¼Œæ–‡ç« å¼ºè°ƒäº†ä½¿ç”¨ Locator å®šä½å™¨æ›¿ä»£è¯­ä¹‰åŒ–å®šä½æ–¹æ³•ï¼Œä»¥æé«˜æµ‹è¯•çš„å‡†ç¡®æ€§ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡äº†ä¸€ä¸ªæ˜é‡‘æŠ½å¥–ç¨‹åºå®ä¾‹å¼ºè°ƒäº†æ–­è¨€çš„é‡è¦æ€§ï¼Œä»¥ç¡®ä¿æµ‹è¯•ä»£ç çš„å¯é æ€§ã€‚</p>',60)]))}]]);export{l as __pageData,o as default};
